// @flow
import type { Dispatch } from 'redux'
import type { OptimisticSyntheticDragEvent, OptimisticSyntheticFocusEvent, Validator } from './types'
import type { ComponentType, ElementRef } from 'react'

type FieldTypeProps = {
  type: 'radio',
  value: any, // mandatory iff type === 'radio'
} | {
  type?: string,
}

export type Props = {
  name: string,

  // this is hard (impossible?) to type strictly - should be ComponentType<FieldProps & Passthrough>
  // where Passthrough is `Props.props & ${any other props passed to the Field component}`
  component: ComponentType<any> | string,

  format?: ?(value: any, name: string) => ?string,
  normalize?: (
    value: any,
    previousValue: any,
    allValues: Object,
    previousAllValues: Object,
    name: string
  ) => ?any,
  onBlur?: (
    event: OptimisticSyntheticFocusEvent,
    newValue: any,
    previousValue: any,
    name: string
  ) => void,
  onChange?: (
    event: SyntheticInputEvent<>,
    newValue: any,
    previousValue: any,
    name: string
  ) => void,
  onDragStart?: (event: OptimisticSyntheticDragEvent, name: string) => void,
  onDrop?: (
    event: OptimisticSyntheticDragEvent,
    newValue: any,
    previousValue: any,
    name: string
  ) => void,
  onFocus?: (event: OptimisticSyntheticFocusEvent, name: string) => void,
  parse?: (value: any, name: string) => any,
  props?: Object,
  type?: string,
  validate?: Validator | Validator[],
  warn?: Validator | Validator[],
  forwardRef?: boolean,
  immutableProps?: Array<string>
} & FieldTypeProps

export type InputProps = {
  checked?: boolean,
  name: string,
  onBlur: { (eventOrValue: OptimisticSyntheticFocusEvent | any): void },
  onChange: { (eventOrValue: SyntheticInputEvent<> | any): void },
  onDrop: { (event: OptimisticSyntheticDragEvent): void },
  onDragStart: { (event: OptimisticSyntheticDragEvent): void },
  onFocus: { (event: OptimisticSyntheticFocusEvent): void },
  value: any
}

export type FieldProps = {
  input: InputProps,
  meta: {
    active: boolean,
    asyncValidating: boolean,
    autofilled: boolean,
    dirty: boolean,
    dispatch: Dispatch<any>,
    error?: any,
    form: string,
    initial?: any,
    invalid: boolean,
    pristine: boolean,
    submitting: boolean,
    submitFailed: boolean,
    touched: boolean,
    valid: boolean,
    visited: boolean,
    warning?: any
  },
  custom: {
    ref?: ElementRef<any>
  }
}
